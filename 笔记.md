# 笔记

## 2025年2月24日

基本完成自适应面配筋，能够选构件配筋

欠缺：锚固、钢筋横竖排版、钢筋均匀排布

接下来尝试增加锚固功能



### 2025年2月24日18:52:02

通过锚固选择工具，将锚固面信息存入在m_faces。

新的单面配筋还需要配置锚固面的信息

先尝试配置锚固面信息，再尝试钢筋锚固

目标1：通过固定的参数，为钢筋实现锚固

m_faces经过转换后作为

tmpAnchordescrs传入CreateAnchorBySelf



## 2025年2月25日

初版面配筋具备锚固功能，通过界面进行配置

目标：将界面激活使用



### 2025年2月25日15:35:41

面配筋端部样式界面成功创建

需要验证组件的数据绑定完整性



### 2025年2月25日16:31:49

可以成功配置弯锚

但是钢筋水平和竖向设计有误，实际上并没有统一方向



### 2025年2月25日17:17:12

通过移植2代的方向纠正功能，钢筋水平和竖向方向自此固定

但是长度似乎无法成功更改，始终保持在默认长度

是UI的问题



## 2025年2月26日

面配筋端部样式界面与主要配筋切换时，端点属性仅能从端部样式传给主要配筋，导致反复切换会丢失端点属性（锚固属性）

需要增加双向数据传递



### 2025年2月26日15:42:10

在切换标签页和点击事件触发时均保存数据

钢筋起止点错误，水平钢筋的终点到了起点之前，且贴近墙面



### 2025年2月26日16:44:26

修复起止点错误，挪用廊道面配筋逻辑，起止点先前后移动一段距离再和面构件比较，计算保护层后的起止点

目标：修正锚固长度为需求锚固长度



### 2025年2月26日17:56:34

廊道面配筋锚固长度属于独立计算，核岛配筋锚固长度采用PS提供的计算方式，可以根据计算方式替换默认参数



## 2025年2月27日

任务：

更换默认锚固长度

修复弯曲钢筋

锚固起止位置提示

多面互锚

多面联合配筋



### 2025年2月27日11:58:21

默认锚固长度应该根据面所在的内外侧分别计算，如果内侧则使用钢筋直径的15倍，外侧使用GetLae()得到再乘以15倍。



目前在锚固修改界面使用内侧计算方式

“弯曲”钢筋在廊道配筋不被支持，会被直接转化为“无”

### 2025年2月27日14:51:20

Bug：点击直锚直接崩溃



### 2025年2月27日15:28:26

分析：直锚钢筋配置长度时，m_strRebarSize可能不在m_alength列表中，导致使用不存在的值而崩溃

处理：检查后再赋值，修复崩溃



### 2025年2月27日15:52:13

分析：预览钢筋会在MakeRebar最后绘制

问题：钢筋绘制的部分线条和实际钢筋位置不相同



### 2025年2月27日16:07:29

分析：绘制预览线条时，只考虑起止点，但是弯锚钢筋的起止点在弯锚后的位置。

解法1：在存入预览线条时，只存入钢筋主体的起止点

解法2：使用其它的数据结构绘制预览线条，争取绘制钢筋主体和弯锚情况



### 2025年2月27日18:01:53

解法：在存入线条时，使用rebarCurvesNum记录的所有点，最后绘制线串



## 2025年2月28日

解法：在绘制完成钢筋后，应该直接使用rebarCurvesNum绘制预览线，它已经拥有了所有合理的钢筋线条



### 2025年2月28日14:10:17

完成钢筋线预览

目标：单体多面互锚功能

先分析原面配筋单体多面互锚功能



### 2025年2月28日17:43:48

争取优化配筋结构设计，将钢筋各项计算提取并独立解耦。

通用的功能放置到FacesRebarAssemblyEx



## 2025年3月3日

任务：

分析原面配筋多面互锚

新面配筋加入多面互锚

次要任务：

新面配筋各类处理功能提取为独立函数



### 2025年3月3日11:39:57

分析：多面互锚会根据选择面的情况，在逐个面配筋时将需要锚固的面加入到m_anchorFaces。经过处理后使用CreateAnchorBySelf调整锚固，锚固关系会涉及内外侧，板墙斜面，耦合性非常高。

优化：

1.手动定义内外侧，对于不同的情况确认锚固关系

2.不考虑内外侧，仅考虑锚固



### 2025年3月3日16:22:45

暂不考虑互锚，因为锚固关系暂无法在不依赖内外侧的情况完成

改为可自定义钢筋额外的延伸长度

目标：分析钢筋偏移的用途，再考虑增加“画线确定延伸钢筋长度”功能



## 2025年3月4日

任务：

分析原面配筋钢筋端部偏移处理方式

修复新面配筋钢筋端部偏移

增加“画线工具确定延伸钢筋长度”功能



### 2025年3月4日13:38:51

在makeRebarCurve中，可以拿到分割后的钢筋起止点，此时再对起止点进行端部位置偏移



### 2025年3月4日15:41:28

在操作向量时，可以用DifferenceOf确定方向。

在操作点时，可以用SumOf向某个方向移动点，注意它会用向量长度，有必要可以先把向量归零



### 2025年3月4日17:59:13

参考廊道剖段线，实现手绘偏移长度线

还需要参考选择锚固面工具了解如何传递MFC



## 2025年3月5日

任务：

增加“画线工具确定延伸钢筋长度”功能

增加单体多面联合配筋



### 2025年3月5日14:10:23

完成“画线工具确定延伸钢筋长度”功能

接下来分析单体多面配筋的具体实现

mdl load intelligentrebar_LD;rrebarld_hd place customizerebar



### 2025年3月5日16:50:34

分析自定义配筋，了解钢筋如何弯曲到多面

自定义配筋在核岛配筋项目中存在，廊道自定义配筋暂时无法使用，可能是版本过低



### 2025年3月5日17:44:47

面配筋可能还有调用配筋模板的功能没有迁移完成



## 2025年3月6日

任务：

理解多段钢筋曲线的绘制方式



### 2025年3月6日15:23:40

优化自定义配筋Create逻辑，更加容易阅读，代码量从一千多行缩短到120行

每一根钢筋曲线位置通过自定义曲线点逐渐按照设定的方向以及间距偏移得到
