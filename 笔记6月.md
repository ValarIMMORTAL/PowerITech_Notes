# 笔记6月

## 2025年6月3日剖断线

尺寸标注：根据图纸总结规律，待开会讨论优化。

剖断线线段拼接有误

### 2025年6月3日15:51:19

剖断线的融合算法有一定缺陷，如果线段出现多个起点相似，终点参差不齐，融合会在最小时提前结束，导致剩下的线段可能没有融合。进而导致出现缺口。

修复：每一段都与后面的所有线段都尝试融合，融合过的线段不再融合。

问题：

1. 某些墙的范围不正确，即使用mdlElmdscr_computeRange计算也无法拿到真实视角上的范围，BFX1504VB背面图上方以及BFX2004VB背面图下方都有这个问题，可能与墙本身在三维中是斜的有关系。



## 2025年6月4日剖断线

尺寸标注：根据图纸总结规律，待开会讨论优化。

剖断线线段拼接有误

### 2025年6月4日11:35:44

修复剖断线不连续，融合算法已在昨日完善，问题在于用于计算的上下墙描述符。

获取上下墙本身有问题，多次获取后会覆盖已有的墙描述符，在检测已有墙id时，与已存在的墙进行合并操作



## 2025年6月5日尺寸标注

尺寸标注：根据图纸总结规律，待开会讨论优化



## 2025年6月6日尺寸标注

开会讨论尺寸标注优化方向

**优化 #86201**修复出板模板图崩溃

**错误 #86202**修复设备基础没有绘制

**优化 #86203**修复标注基础定位

### 2025年6月6日10:31:05

会议结果文件见：《核岛出图尺寸标注优化统计.docx》

摘要：

#### **墙标注规则：**

（1）先标注外围尺寸，左右两侧板的尺寸定位只需要当前范围板的定位，不需要标注背面板的定位。标高同理。

（2）再标注孔洞的定位标注，同位置孔洞尺寸标注需要连线。

（3）孔洞尺寸标注与标注之间不要有重叠。

（4）孔洞尺寸标注与孔洞元素不能有重叠。

（5）标注孔洞尺寸时，先看方向是否为最合适的方向（根据当前方向是否有孔洞元素或者其他方向的尺寸标注），确定方向后再确定标注距离（如果距离不合适就移动，一直找到合适位置为准）。

（6）再标注孔洞和套管名称标注，不要压标注文字和其他墙文字以及套筒标注文字。

#### **板标注规则**

（1）部分斜着的墙方向标注需要按斜向方向进行标注。

（2）其他尺寸标注依据墙标注规则进行。

### 2025年6月6日14:47:38

**优化 #86201**修复出板模板图崩溃

直接出1BFX15---B板时，在最后会发生崩溃。

但是如果提前调试进行断点，或者崩溃后给其它的板出模板图，再尝试则不再崩溃，但是也没有绘制设备基础。底板图中孔洞标注的定点问题很普遍。

测试1：重新bmake -a 后再次直接出1BFX15---B模板图

结果1：确定会崩溃

测试2：崩溃后，出其它板再回来出1BFX15---B模板图

结果2：其它板没有问题，再出图也没有崩溃

测试3：出图时提前断点调试

结果3：在回调函数执行或执行后崩溃

测试4：在参数中取消出背面图

结果4：:不崩溃，有底板图但是仅有几个未知的尺寸标注

测试5：只出1BFX15---B底板模板图

结果5：如果直接完全跳过顶板模板图，会崩溃但是原因不同

### 2025年6月6日17:17:27

**优化 #86201**修复出板模板图崩溃

崩溃问题目前只能定位到跟回调函数有关，在ChangedCallback_LeadDim::OnRootsChanged附近发生了崩溃，直接的空指针崩溃在DgnPlatform5库的GetStyleModelRef，可能与相关的调用有关。

**优化 #86203**修复标注基础定位

定位与孔洞所在区域范围Range有关，似乎不能直接使用轮廓作为基础定位。



## 2025年6月9日崩溃尺寸设备基础消失

**优化 #86201**修复出板模板图崩溃

**错误 #86202**修复设备基础没有绘制

**优化 #86203**修复标注基础定位

### 2025年6月9日13:44:51绘制

所有的绘制在AddFloorProjectfacesAndHolesTo2DModel中

### 2025年6月9日16:18:02

无法直接通过不过滤MB来绘制，MB的元素存在一定问题，一旦操作就会崩溃

### 2025年6月9日17:32:28

尝试在切割元素时，复制一份元素描述符，作为后续处理

在绘制时筛选板元素，不过滤掉MB板，即设备基础

崩溃的原因直观上是因为强制拖动代码运行到绘制，但是并没有修改或者遗漏数据处理，可能是因为release版本强制拖动存在一定隐患。



## 2025年6月10日崩溃

**优化 #86201**修复出板模板图崩溃

**优化 #86203**修复标注基础定位

### 2025年6月10日10:12:46

**优化 #86201**修复出板模板图崩溃

崩溃发生在回调函数使用Create创建引线标注时

使用lineCellEeh.GetElementP()->GetID()发生了崩溃

### 2025年6月10日17:56:07

崩溃原因是引线的定点Z轴未归零



## 2025年6月11日交接

见文档《任务交接-苏畅》

## 2025年6月12日尺寸标注

先熟悉尺寸标注逻辑

## 2025年6月13日墙板尺寸标注

**优化 #86235**【核岛出图ABD】墙板尺寸标注尽量不要标在构件里面，寻找更合适的方向

### 2025年6月13日11:11:04

**优化 #86235**【核岛出图ABD】墙板尺寸标注尽量不要标在构件里面，寻找更合适的方向

根据尺寸标注范围和标注长度构造面，和已有元素进行Fence切割，方向反转后再尝试一次，取切割面积更小的方向。



## 2025年6月16日墙板尺寸标注

**优化 #86235**【核岛出图ABD】墙板尺寸标注尽量不要标在构件里面，寻找更合适的方向

### 2025年6月16日11:49:54

目前的尺寸标注逻辑难以支持重复标注优化，一方面是不确定标注的方向，一方面是无法轻易找到标注墙体的另一侧

### 2025年6月16日17:59:15

优先处理**优化 #86240**【核岛出图ABD】墙板尺寸标注尽量去掉重复标注

先排序再去重，同时记录每一组对应的方向

尝试合并，应该修改为对应**方向上更大**的融合掉**更小**的



## 2025年6月17日墙板重复尺寸标注

优先处理**优化 #86240**【核岛出图ABD】墙板尺寸标注尽量去掉重复标注
