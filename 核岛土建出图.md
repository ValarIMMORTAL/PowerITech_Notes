# 核岛土建出图

### CreateArc2DElements

创建出图信息

### AddAllRebarLinesToDgnModel

**描述**：处理钢筋的图形信息，并为模型生成适当的标注和尺寸。

**弧形**有更多的数据处理：

**排序阶段**：首先按面的位置进行排序。

**钢筋遍历**：遍历每一组钢筋，查找对应的面，并将钢筋添加到链表。

**尺寸计算与标注**：计算钢筋的尺寸并添加标注。

**图形更新**：根据 `m_generateType` 的类型更新或刷新图形，最终将钢筋线添加到模型中。

### CalculateRebarLDs

**描述**：计算和处理所有钢筋组的相关信息（钢筋数据的整理、分类、层次分配、钢筋形状处理、属性计算等）

**数据整理**：通过 `StringOperator::Convert::to_justnum` 将钢筋编号标准化并重新分组。

**层次和类型统计**：通过 `GetRebarLevelItemTypeValue` 获取钢筋层级和类型信息，进行统计。

**钢筋计算**：计算每组钢筋的尺寸、方向、间距、套筒信息等。

**最终保存**：将所有计算结果保存到 `rebarLD` 结构体中，并添加到结果列表。

### AddRebarLinesToModel

**描述**：将钢筋线和标注添加到模型中，涉及钢筋层信息的获取、钢筋线的绘制、钢筋标注的生成、标注位置的调整和排序等。

**获取钢筋层信息**：通过 `GetMapLevelid` 获取配筋图层的相关数据。

**遍历钢筋数据**：遍历每组钢筋，计算钢筋线、添加标注并进行必要的转换。

**计算图面范围**：获取整个图面范围，用于标注位置的调整。

**标注调整**：根据钢筋标注的方向（上、下、左、右）调整标注位置。

**更新标注属性**：在需要时更新钢筋标注的属性（如颜色）。

### CalcRebarLine

**描述**：计算并生成钢筋线，将三维钢筋线转换为二维钢筋线，并根据钢筋的属性进行适当的设置。涉及钢筋线的复制、图层设置、线型设置、钢筋属性的修改等。

**初始化检查**：检查钢筋组是否为长度渐变的钢筋组，并初始化必要的变量。

**处理长度渐变钢筋组**：如果是长度渐变的钢筋组，逐个处理每根钢筋，将其三维钢筋线转换为二维钢筋线，并设置图层和样式。

**处理普通钢筋组**：处理普通钢筋组，复制三维钢筋线并进行设置。

**存储钢筋信息**：将钢筋 ID 和范围信息存储到钢筋线中。

**依赖关系**：设置钢筋线的依赖关系，确保在拖动时重新绘制。

**返回钢筋线 ID**：返回钢筋线的 ID 并存储在 `rebar` 对象中。

### Add_SleeveAndGalon

**描述**：根据钢筋的类型（如 Coupler、Galon、Anchor Slab 等）在钢筋的起始和结束位置添加相应的套筒（Coupler）、钢筋帽（Galon）或锚板（Anchor Slab）。涉及钢筋起始和结束点的处理、套筒的创建、标注组的管理、以及钢筋线的属性设置。

### CreateRebarDim

为钢筋线添加标注，并根据钢筋的方向（X 方向或 Y 方向）决定标注的显示位置。函数通过计算钢筋组的二维中心点，判断标注的位置（上、下、左、右），并调用相应的标注创建函数。它涉及钢筋中心点的计算、标注方向的确定、标注元素的创建以及标注组的管理。

### CreateRebarDim_UpOrDownEle

**描述**：用于为钢筋线创建和放置标注。根据钢筋的方向（即 `Ydir`），函数会判断标注应该放置在钢筋线的上方还是下方，并进行相应的标注创建和位置调整。它还涉及钢筋信息的存储、图层设置、依赖关系管理等操作。

**标注位置计算**：根据钢筋的方向（上下）和标注位置计算，决定标注放置的具体位置。

**标注文本创建**：创建并设置钢筋编号文本，确保文本正确显示。

**钢筋信息存储**：将钢筋的各种信息存储在 `rebarDimInfo` 结构中，确保后续可以通过这些信息更新或查询钢筋的相关属性。

**依赖关系管理**：为标注元素和钢筋线元素之间建立依赖关系，确保它们的同步更新。

**命名组管理**：将标注元素加入到命名组中，以便于管理。







#### DrawLeftOrRightRangeOrSignleDim

绘制延长线、交点处斜线、区间钢筋根数、三角箭头

#### DrawLeftOrRightSpacingAndNumDim

创建钢筋组中数量-钢筋直径标注和钢筋层标注

#### CreateRebarDim_upOrdownCellText

绘制除开钢筋组编号字体的整个钢筋组标注，上下的标注样式

## 优化#弧形墙缩略图套管方向

![image-20241225104924854](核岛土建出图.assets/image-20241225104924854.png)

GetShapeElment

在首尾点获取弧形的切线方向作为套管方向

函数详情见API记录：mdlElmdscr_extractEndPoints

## 优化#弧形墙套管位置

![image-20241225114905817](核岛土建出图.assets/image-20241225114905817.png)

在Add_SleeveAndGalon中绘制套管，需要查明是钢筋线过长还是套管位置不对
